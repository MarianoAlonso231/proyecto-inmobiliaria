"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[714],{9174:function(e,r,o){o.d(r,{C:function(){return c}});var t=o(7437);o(2265);var a=o(535),n=o(3448);let s=(0,a.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function c(e){let{className:r,variant:o,...a}=e;return(0,t.jsx)("div",{className:(0,n.cn)(s({variant:o}),r),...a})}},4306:function(e,r,o){o.d(r,{CH:function(){return i},U$:function(){return u},hG:function(){return l}});var t=o(2265),a=o(5526),n=o(9694);let s="properties-images";async function c(e){try{if(!e.type.startsWith("image/"))return{success:!1,error:"El archivo debe ser una imagen"};if(e.size>5242880)return{success:!1,error:"La imagen es demasiado grande (m\xe1ximo 5MB)"};let r=e.name.split(".").pop(),o="".concat(Date.now(),"_").concat(Math.random().toString(36).substring(2),".").concat(r),{data:t,error:n}=await a.O.storage.from(s).upload(o,e);if(n)return{success:!1,error:n.message};let{data:c}=a.O.storage.from(s).getPublicUrl(o);return{success:!0,url:c.publicUrl}}catch(e){return{success:!1,error:"Error al subir la imagen"}}}let i={title:"",description:"",price:"",currency:"USD",operation_type:"",property_type:"",bedrooms:"0",bathrooms:"0",construccion:"",terreno:"",address:"",neighborhood:"",city:"San Miguel de Tucum\xe1n",province:"Tucum\xe1n",country:"Argentina",features:"",images:[],featured:!1,status:"disponible",barrio_cerrado:!1,es_country:!1,paga_expensas:!1};function l(){let[e,r]=(0,t.useState)([]),[o,s]=(0,t.useState)(!0),[i,l]=(0,t.useState)(null),u=async()=>{try{s(!0),l(null);let{data:e,error:o}=await a.O.from("properties").select("*").order("created_at",{ascending:!1});if(o)throw o;r(e||[])}catch(e){console.error("Error al cargar propiedades:",e),l("Error al cargar las propiedades")}finally{s(!1)}},d=async e=>{try{if(l(null),!e.title||!e.price||!e.operation_type||!e.property_type)return l("Por favor completa todos los campos obligatorios"),!1;let r=[],o=e.images.filter(e=>"file"===e.type&&e.file);if(o.length>0){for(let e of(console.log("\uD83D\uDCE4 Subiendo ".concat(o.length," im\xe1genes nuevas...")),o))if(e.file){let o=await c(e.file);if(!o.success||!o.url)return console.error("Error subiendo imagen:",o.error),l("Error al subir imagen: ".concat(o.error)),!1;r.push(o.url)}}let t=[...e.images.filter(e=>"url"===e.type&&e.url).map(e=>e.url),...r],n={title:e.title,description:e.description,price:parseFloat(e.price),currency:e.currency,operation_type:e.operation_type,property_type:e.property_type,bedrooms:parseInt(e.bedrooms),bathrooms:parseInt(e.bathrooms),construccion:parseFloat(e.construccion)||null,terreno:e.terreno?parseFloat(e.terreno):null,address:e.address,neighborhood:e.neighborhood,city:e.city,province:e.province,country:e.country,features:e.features?e.features.split(",").map(e=>e.trim()):[],images:t,featured:e.featured,status:e.status,barrio_cerrado:e.barrio_cerrado,es_country:e.es_country,paga_expensas:e.paga_expensas},{error:s}=await a.O.from("properties").insert([n]);if(s)throw s;return await u(),!0}catch(e){return console.error("Error al crear propiedad:",e),l("Error al crear la propiedad"),!1}},p=async(e,r)=>{try{if(l(null),!r.title||!r.price||!r.operation_type||!r.property_type)return l("Por favor completa todos los campos obligatorios"),!1;let o=[],t=r.images.filter(e=>"file"===e.type&&e.file);if(t.length>0){for(let e of(console.log("\uD83D\uDCE4 Subiendo ".concat(t.length," im\xe1genes nuevas...")),t))if(e.file){let r=await c(e.file);if(!r.success||!r.url)return console.error("Error subiendo imagen:",r.error),l("Error al subir imagen: ".concat(r.error)),!1;o.push(r.url)}}let n=[...r.images.filter(e=>"url"===e.type&&e.url).map(e=>e.url),...o],s={title:r.title,description:r.description,price:parseFloat(r.price),currency:r.currency,operation_type:r.operation_type,property_type:r.property_type,bedrooms:parseInt(r.bedrooms),bathrooms:parseInt(r.bathrooms),construccion:parseFloat(r.construccion)||null,terreno:r.terreno?parseFloat(r.terreno):null,address:r.address,neighborhood:r.neighborhood,city:r.city,province:r.province,country:r.country,features:r.features?r.features.split(",").map(e=>e.trim()):[],images:n,featured:r.featured,status:r.status,barrio_cerrado:r.barrio_cerrado,es_country:r.es_country,paga_expensas:r.paga_expensas},{error:i}=await a.O.from("properties").update(s).eq("id",e);if(i)throw i;return await u(),!0}catch(e){return console.error("Error al actualizar propiedad:",e),l("Error al actualizar la propiedad"),!1}},g=async e=>{try{l(null);let r=await (0,n.zu)(e);if(!r.success)throw Error(r.error||"Error al eliminar la propiedad");return await u(),!0}catch(e){return console.error("Error al eliminar propiedad:",e),l(e instanceof Error?e.message:"Error al eliminar la propiedad"),!1}};(0,t.useEffect)(()=>{u()},[]);let f={total:e.length,ventas:e.filter(e=>"venta"===e.operation_type).length,alquileres:e.filter(e=>"alquiler"===e.operation_type).length,destacadas:e.filter(e=>e.featured).length,disponibles:e.filter(e=>"disponible"===e.status).length,vendidas:e.filter(e=>"vendido"===e.status).length,alquiladas:e.filter(e=>"alquilado"===e.status).length,reservadas:e.filter(e=>"reservado"===e.status).length};return{properties:e,isLoading:o,error:i,stats:f,loadProperties:u,createProperty:d,updateProperty:p,deleteProperty:g,propertyToFormData:e=>{var r,o;let t=e.images.map(e=>({id:"url_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),type:"url",url:e,preview:e}));return{title:e.title,description:e.description||"",price:e.price.toString(),currency:e.currency,operation_type:e.operation_type,property_type:e.property_type,bedrooms:e.bedrooms.toString(),bathrooms:e.bathrooms.toString(),construccion:(null===(r=e.construccion)||void 0===r?void 0:r.toString())||"",terreno:(null===(o=e.terreno)||void 0===o?void 0:o.toString())||"",address:e.address||"",neighborhood:e.neighborhood||"",city:e.city,province:e.province,country:e.country,features:e.features.join(", "),images:t,featured:e.featured,status:e.status,barrio_cerrado:e.barrio_cerrado||!1,es_country:e.es_country||!1,paga_expensas:e.paga_expensas||!1}},clearError:()=>l(null)}}function u(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6,[r,o]=(0,t.useState)([]),[n,s]=(0,t.useState)(!0),[c,i]=(0,t.useState)(null),l=async()=>{try{s(!0),i(null);let{data:r,error:t}=await a.O.from("properties").select("*").eq("featured",!0).eq("status","disponible").order("created_at",{ascending:!1}).limit(e);if(t)throw t;o(r||[])}catch(e){console.error("Error al cargar propiedades destacadas:",e),i("Error al cargar las propiedades destacadas")}finally{s(!1)}};return(0,t.useEffect)(()=>{l()},[e]),{featuredProperties:r,isLoading:n,error:c,loadFeaturedProperties:l,clearError:()=>i(null)}}},5526:function(e,r,o){o.d(r,{O:function(){return t}});let t=(0,o(5214).createBrowserClient)("https://enaltafiofwcbfrlyguz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVuYWx0YWZpb2Z3Y2Jmcmx5Z3V6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg5MTE3NDAsImV4cCI6MjA2NDQ4Nzc0MH0.CSAL1XSmuRG0jkBfP03e0__R-bweK3YIZi_NkiLp1ko")},9694:function(e,r,o){o.d(r,{In:function(){return d},iQ:function(){return l},y9:function(){return i},zu:function(){return u}});var t=o(5526);let a="properties-images";async function n(){try{let{data:e}=t.O.storage.from(a).getPublicUrl("test-file.jpg");if(null==e?void 0:e.publicUrl){let r=e.publicUrl.replace("test-file.jpg","");return console.log("\uD83D\uDD0D URL base detectada: ".concat(r)),r}}catch(e){console.warn("No se pudo detectar URL base din\xe1micamente, usando fallback")}return"https://wxlzstrodefylrgzr.supabase.co/storage/v1/object/public/".concat(a,"/")}let s=null;function c(e,r){try{if(!e.includes(a))return console.warn("URL no contiene el bucket ".concat(a,": ").concat(e)),null;if(r&&e.includes(r)){let o=e.replace(r,"");return console.log("✅ M\xe9todo 1 - Nombre extra\xeddo: ".concat(o)),o}let o="/".concat(a,"/"),t=e.indexOf(o);if(-1!==t){let r=e.substring(t+o.length);return console.log("✅ M\xe9todo 2 - Nombre extra\xeddo: ".concat(r)),r}let n="".concat(a,"/"),s=e.indexOf(n);if(-1!==s){let r=e.substring(s+n.length);return console.log("✅ M\xe9todo 3 - Nombre extra\xeddo: ".concat(r)),r}let c=e.split("/"),i=c[c.length-1];if(i&&i.includes("."))return console.log("⚠️ M\xe9todo 4 (\xfaltimo recurso) - Nombre extra\xeddo: ".concat(i)),i;return console.error("❌ No se pudo extraer nombre de archivo de: ".concat(e)),null}catch(e){return console.error("Error al extraer nombre de archivo:",e),null}}async function i(){try{console.log("\uD83D\uDD0D Iniciando an\xe1lisis de im\xe1genes hu\xe9rfanas..."),s||(s=await n()),console.log("\uD83C\uDF10 Usando URL base: ".concat(s));let{data:e,error:r}=await t.O.storage.from(a).list();if(r)return{success:!1,error:"Error al obtener archivos del Storage: ".concat(r.message)};if(!e||0===e.length)return console.log("✅ No hay archivos en el Storage"),{success:!0,data:{totalFilesInStorage:0,totalReferencedImages:0,orphanedFiles:[],referencedFiles:[]}};let o=e.map(e=>e.name);console.log("\uD83D\uDCC1 Archivos encontrados en Storage: ".concat(o.length));let{data:i,error:l}=await t.O.from("properties").select("images");if(l)return{success:!1,error:"Error al obtener propiedades: ".concat(l.message)};let u=new Set,d=0,p=0;console.log("\uD83D\uDD17 Procesando URLs de im\xe1genes en la base de datos..."),i&&i.length>0&&i.forEach((e,r)=>{var o;console.log("\uD83D\uDCCB Propiedad ".concat(r+1,": ").concat((null===(o=e.images)||void 0===o?void 0:o.length)||0," im\xe1genes")),e.images&&Array.isArray(e.images)&&e.images.forEach((e,r)=>{d++,console.log("   \uD83D\uDDBC️  Imagen ".concat(r+1,": ").concat(e));let o=c(e,s||void 0);o?(u.add(o),p++,console.log("      ✅ Archivo referenciado: ".concat(o))):console.error("      ❌ No se pudo extraer nombre de archivo de: ".concat(e))})}),console.log("\uD83D\uDCCA URLs procesadas: ".concat(d)),console.log("✅ Extracciones exitosas: ".concat(p)),console.log("❌ Extracciones fallidas: ".concat(d-p)),console.log("\uD83D\uDD17 Archivos \xfanicos referenciados: ".concat(u.size));let g=o.filter(e=>!u.has(e));console.log("\uD83D\uDDD1️ Im\xe1genes hu\xe9rfanas encontradas: ".concat(g.length));let f={totalFilesInStorage:o.length,totalReferencedImages:u.size,orphanedFiles:g,referencedFiles:Array.from(u)};return{success:!0,data:f}}catch(e){return console.error("Error en findOrphanedImages:",e),{success:!1,error:"Error interno al analizar im\xe1genes hu\xe9rfanas"}}}async function l(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];try{console.log("\uD83E\uDDF9 Iniciando limpieza de im\xe1genes hu\xe9rfanas (modo: ".concat(e?"simulaci\xf3n":"real",")..."));let r=await i();if(!r.success||!r.data)return{success:!1,error:r.error};let o=r.data,n=o.orphanedFiles;if(0===o.totalReferencedImages&&o.totalFilesInStorage>0){let e="\uD83D\uDEA8 PELIGRO: No se encontraron im\xe1genes referenciadas en la DB, pero hay ".concat(o.totalFilesInStorage," archivos en Storage. Esto sugiere un error en la extracci\xf3n de nombres de archivo. LIMPIEZA CANCELADA POR SEGURIDAD.");return console.error(e),{success:!1,error:e}}if(o.totalFilesInStorage>0){let r=n.length/o.totalFilesInStorage*100;if(r>90){let t="⚠️ ADVERTENCIA: Se eliminar\xedan ".concat(n.length," de ").concat(o.totalFilesInStorage," archivos (").concat(r.toFixed(1),"%). Esto es sospechoso - por favor revisa manualmente.");if(console.warn(t),!e)return{success:!1,error:t}}}if(0===n.length)return console.log("✅ No hay im\xe1genes hu\xe9rfanas para eliminar"),{success:!0,deletedCount:0,errors:[]};if(e)return console.log("\uD83D\uDD0D SIMULACI\xd3N - Archivos que se eliminar\xedan:"),n.forEach(e=>console.log("  - ".concat(e))),{success:!0,deletedCount:n.length,errors:[]};let s=[],c=0;for(let e=0;e<n.length;e+=10){let r=n.slice(e,e+10);console.log("\uD83D\uDDD1️ Eliminando lote ".concat(Math.floor(e/10)+1,"/").concat(Math.ceil(n.length/10)));let{data:o,error:i}=await t.O.storage.from(a).remove(r);i?(s.push("Error en lote ".concat(Math.floor(e/10)+1,": ").concat(i.message)),console.error("❌ Error eliminando lote:",i)):(c+=r.length,console.log("✅ Eliminados ".concat(r.length," archivos del lote"))),e+10<n.length&&await new Promise(e=>setTimeout(e,500))}return console.log("\uD83C\uDF89 Limpieza completada. Archivos eliminados: ".concat(c,"/").concat(n.length)),{success:!0,deletedCount:c,errors:s.length>0?s:void 0}}catch(e){return console.error("Error en cleanupOrphanedImages:",e),{success:!1,error:"Error interno al limpiar im\xe1genes hu\xe9rfanas"}}}async function u(e){try{console.log("\uD83C\uDFE0 Iniciando eliminaci\xf3n segura de propiedad: ".concat(e)),s||(s=await n());let{data:r,error:o}=await t.O.from("properties").select("images").eq("id",e).single();if(o){if("PGRST116"===o.code)return{success:!1,error:"Propiedad no encontrada"};return{success:!1,error:"Error al obtener propiedad: ".concat(o.message)}}let i=[];r.images&&Array.isArray(r.images)&&r.images.forEach(e=>{let r=c(e,s||void 0);r&&i.push(r)}),console.log("\uD83D\uDDBC️ Im\xe1genes a eliminar: ".concat(i.length));let l=0;if(i.length>0){let{data:e,error:r}=await t.O.storage.from(a).remove(i);if(r)return console.error("❌ Error eliminando im\xe1genes del Storage:",r),{success:!1,error:"Error al eliminar im\xe1genes: ".concat(r.message)};l=i.length,console.log("✅ Eliminadas ".concat(l," im\xe1genes del Storage"))}let{error:u}=await t.O.from("properties").delete().eq("id",e);if(u)return console.error("❌ Error eliminando propiedad de la DB:",u),{success:!1,error:"Error al eliminar propiedad: ".concat(u.message)};return console.log("\uD83C\uDF89 Propiedad eliminada exitosamente: ".concat(e)),{success:!0,deletedImages:l}}catch(e){return console.error("Error en deletePropertySafely:",e),{success:!1,error:"Error interno al eliminar propiedad"}}}async function d(){try{let e=await i();if(!e.success)return{success:!1,error:e.error};let r=e.data,o={totalFiles:r.totalFilesInStorage,referencedImages:r.totalReferencedImages,orphanedImages:r.orphanedFiles.length,storageHealth:0===r.orphanedFiles.length?"excelente":r.orphanedFiles.length<5?"bueno":r.orphanedFiles.length<20?"regular":"requiere_atencion",lastCheck:new Date().toISOString()};return{success:!0,stats:o}}catch(e){return console.error("Error en getStorageStats:",e),{success:!1,error:"Error interno al obtener estad\xedsticas"}}}}}]);