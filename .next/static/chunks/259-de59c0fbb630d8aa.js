"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[259],{9174:function(e,r,o){o.d(r,{C:function(){return i}});var t=o(7437);o(2265);var a=o(535),n=o(3448);let s=(0,a.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:r,variant:o,...a}=e;return(0,t.jsx)("div",{className:(0,n.cn)(s({variant:o}),r),...a})}},8785:function(e,r,o){o.d(r,{CH:function(){return s},U$:function(){return l},hG:function(){return i}});var t=o(2265),a=o(5526),n=o(9694);let s={title:"",description:"",price:"",currency:"USD",operation_type:"",property_type:"",bedrooms:"0",bathrooms:"0",area_m2:"",lot_area_m2:"",address:"",neighborhood:"",city:"San Miguel de Tucum\xe1n",province:"Tucum\xe1n",country:"Argentina",features:"",images:"",featured:!1,status:"disponible"};function i(){let[e,r]=(0,t.useState)([]),[o,s]=(0,t.useState)(!0),[i,l]=(0,t.useState)(null),c=async()=>{try{s(!0),l(null);let{data:e,error:o}=await a.O.from("properties").select("*").order("created_at",{ascending:!1});if(o)throw o;r(e||[])}catch(e){console.error("Error al cargar propiedades:",e),l("Error al cargar las propiedades")}finally{s(!1)}},u=async e=>{try{if(l(null),!e.title||!e.price||!e.operation_type||!e.property_type)return l("Por favor completa todos los campos obligatorios"),!1;let r={title:e.title,description:e.description,price:parseFloat(e.price),currency:e.currency,operation_type:e.operation_type,property_type:e.property_type,bedrooms:parseInt(e.bedrooms),bathrooms:parseInt(e.bathrooms),area_m2:parseFloat(e.area_m2)||null,lot_area_m2:e.lot_area_m2?parseFloat(e.lot_area_m2):null,address:e.address,neighborhood:e.neighborhood,city:e.city,province:e.province,country:e.country,features:e.features?e.features.split(",").map(e=>e.trim()):[],images:e.images?e.images.split(",").map(e=>e.trim()):[],featured:e.featured,status:e.status},{error:o}=await a.O.from("properties").insert([r]);if(o)throw o;return await c(),!0}catch(e){return console.error("Error al crear propiedad:",e),l("Error al crear la propiedad"),!1}},d=async(e,r)=>{try{if(l(null),!r.title||!r.price||!r.operation_type||!r.property_type)return l("Por favor completa todos los campos obligatorios"),!1;let o={title:r.title,description:r.description,price:parseFloat(r.price),currency:r.currency,operation_type:r.operation_type,property_type:r.property_type,bedrooms:parseInt(r.bedrooms),bathrooms:parseInt(r.bathrooms),area_m2:parseFloat(r.area_m2)||null,lot_area_m2:r.lot_area_m2?parseFloat(r.lot_area_m2):null,address:r.address,neighborhood:r.neighborhood,city:r.city,province:r.province,country:r.country,features:r.features?r.features.split(",").map(e=>e.trim()):[],images:r.images?r.images.split(",").map(e=>e.trim()):[],featured:r.featured,status:r.status},{error:t}=await a.O.from("properties").update(o).eq("id",e);if(t)throw t;return await c(),!0}catch(e){return console.error("Error al actualizar propiedad:",e),l("Error al actualizar la propiedad"),!1}},p=async e=>{try{l(null);let r=await (0,n.zu)(e);if(!r.success)throw Error(r.error||"Error al eliminar la propiedad");return await c(),!0}catch(e){return console.error("Error al eliminar propiedad:",e),l(e instanceof Error?e.message:"Error al eliminar la propiedad"),!1}};(0,t.useEffect)(()=>{c()},[]);let g={total:e.length,ventas:e.filter(e=>"venta"===e.operation_type).length,alquileres:e.filter(e=>"alquiler"===e.operation_type).length,destacadas:e.filter(e=>e.featured).length,disponibles:e.filter(e=>"disponible"===e.status).length,vendidas:e.filter(e=>"vendido"===e.status).length,alquiladas:e.filter(e=>"alquilado"===e.status).length,reservadas:e.filter(e=>"reservado"===e.status).length};return{properties:e,isLoading:o,error:i,stats:g,loadProperties:c,createProperty:u,updateProperty:d,deleteProperty:p,propertyToFormData:e=>{var r,o;return{title:e.title,description:e.description||"",price:e.price.toString(),currency:e.currency,operation_type:e.operation_type,property_type:e.property_type,bedrooms:e.bedrooms.toString(),bathrooms:e.bathrooms.toString(),area_m2:(null===(r=e.area_m2)||void 0===r?void 0:r.toString())||"",lot_area_m2:(null===(o=e.lot_area_m2)||void 0===o?void 0:o.toString())||"",address:e.address||"",neighborhood:e.neighborhood||"",city:e.city,province:e.province,country:e.country,features:e.features.join(", "),images:e.images.join(", "),featured:e.featured,status:e.status}},clearError:()=>l(null)}}function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6,[r,o]=(0,t.useState)([]),[n,s]=(0,t.useState)(!0),[i,l]=(0,t.useState)(null),c=async()=>{try{s(!0),l(null);let{data:r,error:t}=await a.O.from("properties").select("*").eq("featured",!0).eq("status","disponible").order("created_at",{ascending:!1}).limit(e);if(t)throw t;o(r||[])}catch(e){console.error("Error al cargar propiedades destacadas:",e),l("Error al cargar las propiedades destacadas")}finally{s(!1)}};return(0,t.useEffect)(()=>{c()},[e]),{featuredProperties:r,isLoading:n,error:i,loadFeaturedProperties:c,clearError:()=>l(null)}}},5526:function(e,r,o){o.d(r,{O:function(){return t}});let t=(0,o(5214).createBrowserClient)("https://enaltafiofwcbfrlyguz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVuYWx0YWZpb2Z3Y2Jmcmx5Z3V6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg5MTE3NDAsImV4cCI6MjA2NDQ4Nzc0MH0.CSAL1XSmuRG0jkBfP03e0__R-bweK3YIZi_NkiLp1ko")},9694:function(e,r,o){o.d(r,{In:function(){return d},iQ:function(){return c},y9:function(){return l},zu:function(){return u}});var t=o(5526);let a="properties-images";async function n(){try{let{data:e}=t.O.storage.from(a).getPublicUrl("test-file.jpg");if(null==e?void 0:e.publicUrl){let r=e.publicUrl.replace("test-file.jpg","");return console.log("\uD83D\uDD0D URL base detectada: ".concat(r)),r}}catch(e){console.warn("No se pudo detectar URL base din\xe1micamente, usando fallback")}return"https://wxlzstrodefylrgzr.supabase.co/storage/v1/object/public/".concat(a,"/")}let s=null;function i(e,r){try{if(!e.includes(a))return console.warn("URL no contiene el bucket ".concat(a,": ").concat(e)),null;if(r&&e.includes(r)){let o=e.replace(r,"");return console.log("✅ M\xe9todo 1 - Nombre extra\xeddo: ".concat(o)),o}let o="/".concat(a,"/"),t=e.indexOf(o);if(-1!==t){let r=e.substring(t+o.length);return console.log("✅ M\xe9todo 2 - Nombre extra\xeddo: ".concat(r)),r}let n="".concat(a,"/"),s=e.indexOf(n);if(-1!==s){let r=e.substring(s+n.length);return console.log("✅ M\xe9todo 3 - Nombre extra\xeddo: ".concat(r)),r}let i=e.split("/"),l=i[i.length-1];if(l&&l.includes("."))return console.log("⚠️ M\xe9todo 4 (\xfaltimo recurso) - Nombre extra\xeddo: ".concat(l)),l;return console.error("❌ No se pudo extraer nombre de archivo de: ".concat(e)),null}catch(e){return console.error("Error al extraer nombre de archivo:",e),null}}async function l(){try{console.log("\uD83D\uDD0D Iniciando an\xe1lisis de im\xe1genes hu\xe9rfanas..."),s||(s=await n()),console.log("\uD83C\uDF10 Usando URL base: ".concat(s));let{data:e,error:r}=await t.O.storage.from(a).list();if(r)return{success:!1,error:"Error al obtener archivos del Storage: ".concat(r.message)};if(!e||0===e.length)return console.log("✅ No hay archivos en el Storage"),{success:!0,data:{totalFilesInStorage:0,totalReferencedImages:0,orphanedFiles:[],referencedFiles:[]}};let o=e.map(e=>e.name);console.log("\uD83D\uDCC1 Archivos encontrados en Storage: ".concat(o.length));let{data:l,error:c}=await t.O.from("properties").select("images");if(c)return{success:!1,error:"Error al obtener propiedades: ".concat(c.message)};let u=new Set,d=0,p=0;console.log("\uD83D\uDD17 Procesando URLs de im\xe1genes en la base de datos..."),l&&l.length>0&&l.forEach((e,r)=>{var o;console.log("\uD83D\uDCCB Propiedad ".concat(r+1,": ").concat((null===(o=e.images)||void 0===o?void 0:o.length)||0," im\xe1genes")),e.images&&Array.isArray(e.images)&&e.images.forEach((e,r)=>{d++,console.log("   \uD83D\uDDBC️  Imagen ".concat(r+1,": ").concat(e));let o=i(e,s||void 0);o?(u.add(o),p++,console.log("      ✅ Archivo referenciado: ".concat(o))):console.error("      ❌ No se pudo extraer nombre de archivo de: ".concat(e))})}),console.log("\uD83D\uDCCA URLs procesadas: ".concat(d)),console.log("✅ Extracciones exitosas: ".concat(p)),console.log("❌ Extracciones fallidas: ".concat(d-p)),console.log("\uD83D\uDD17 Archivos \xfanicos referenciados: ".concat(u.size));let g=o.filter(e=>!u.has(e));console.log("\uD83D\uDDD1️ Im\xe1genes hu\xe9rfanas encontradas: ".concat(g.length));let m={totalFilesInStorage:o.length,totalReferencedImages:u.size,orphanedFiles:g,referencedFiles:Array.from(u)};return{success:!0,data:m}}catch(e){return console.error("Error en findOrphanedImages:",e),{success:!1,error:"Error interno al analizar im\xe1genes hu\xe9rfanas"}}}async function c(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];try{console.log("\uD83E\uDDF9 Iniciando limpieza de im\xe1genes hu\xe9rfanas (modo: ".concat(e?"simulaci\xf3n":"real",")..."));let r=await l();if(!r.success||!r.data)return{success:!1,error:r.error};let o=r.data,n=o.orphanedFiles;if(0===o.totalReferencedImages&&o.totalFilesInStorage>0){let e="\uD83D\uDEA8 PELIGRO: No se encontraron im\xe1genes referenciadas en la DB, pero hay ".concat(o.totalFilesInStorage," archivos en Storage. Esto sugiere un error en la extracci\xf3n de nombres de archivo. LIMPIEZA CANCELADA POR SEGURIDAD.");return console.error(e),{success:!1,error:e}}if(o.totalFilesInStorage>0){let r=n.length/o.totalFilesInStorage*100;if(r>90){let t="⚠️ ADVERTENCIA: Se eliminar\xedan ".concat(n.length," de ").concat(o.totalFilesInStorage," archivos (").concat(r.toFixed(1),"%). Esto es sospechoso - por favor revisa manualmente.");if(console.warn(t),!e)return{success:!1,error:t}}}if(0===n.length)return console.log("✅ No hay im\xe1genes hu\xe9rfanas para eliminar"),{success:!0,deletedCount:0,errors:[]};if(e)return console.log("\uD83D\uDD0D SIMULACI\xd3N - Archivos que se eliminar\xedan:"),n.forEach(e=>console.log("  - ".concat(e))),{success:!0,deletedCount:n.length,errors:[]};let s=[],i=0;for(let e=0;e<n.length;e+=10){let r=n.slice(e,e+10);console.log("\uD83D\uDDD1️ Eliminando lote ".concat(Math.floor(e/10)+1,"/").concat(Math.ceil(n.length/10)));let{data:o,error:l}=await t.O.storage.from(a).remove(r);l?(s.push("Error en lote ".concat(Math.floor(e/10)+1,": ").concat(l.message)),console.error("❌ Error eliminando lote:",l)):(i+=r.length,console.log("✅ Eliminados ".concat(r.length," archivos del lote"))),e+10<n.length&&await new Promise(e=>setTimeout(e,500))}return console.log("\uD83C\uDF89 Limpieza completada. Archivos eliminados: ".concat(i,"/").concat(n.length)),{success:!0,deletedCount:i,errors:s.length>0?s:void 0}}catch(e){return console.error("Error en cleanupOrphanedImages:",e),{success:!1,error:"Error interno al limpiar im\xe1genes hu\xe9rfanas"}}}async function u(e){try{console.log("\uD83C\uDFE0 Iniciando eliminaci\xf3n segura de propiedad: ".concat(e)),s||(s=await n());let{data:r,error:o}=await t.O.from("properties").select("images").eq("id",e).single();if(o){if("PGRST116"===o.code)return{success:!1,error:"Propiedad no encontrada"};return{success:!1,error:"Error al obtener propiedad: ".concat(o.message)}}let l=[];r.images&&Array.isArray(r.images)&&r.images.forEach(e=>{let r=i(e,s||void 0);r&&l.push(r)}),console.log("\uD83D\uDDBC️ Im\xe1genes a eliminar: ".concat(l.length));let c=0;if(l.length>0){let{data:e,error:r}=await t.O.storage.from(a).remove(l);if(r)return console.error("❌ Error eliminando im\xe1genes del Storage:",r),{success:!1,error:"Error al eliminar im\xe1genes: ".concat(r.message)};c=l.length,console.log("✅ Eliminadas ".concat(c," im\xe1genes del Storage"))}let{error:u}=await t.O.from("properties").delete().eq("id",e);if(u)return console.error("❌ Error eliminando propiedad de la DB:",u),{success:!1,error:"Error al eliminar propiedad: ".concat(u.message)};return console.log("\uD83C\uDF89 Propiedad eliminada exitosamente: ".concat(e)),{success:!0,deletedImages:c}}catch(e){return console.error("Error en deletePropertySafely:",e),{success:!1,error:"Error interno al eliminar propiedad"}}}async function d(){try{let e=await l();if(!e.success)return{success:!1,error:e.error};let r=e.data,o={totalFiles:r.totalFilesInStorage,referencedImages:r.totalReferencedImages,orphanedImages:r.orphanedFiles.length,storageHealth:0===r.orphanedFiles.length?"excelente":r.orphanedFiles.length<5?"bueno":r.orphanedFiles.length<20?"regular":"requiere_atencion",lastCheck:new Date().toISOString()};return{success:!0,stats:o}}catch(e){return console.error("Error en getStorageStats:",e),{success:!1,error:"Error interno al obtener estad\xedsticas"}}}}}]);