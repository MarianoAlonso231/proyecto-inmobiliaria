exports.id=366,exports.ids=[366],exports.modules={3244:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=3244,e.exports=r},8359:()=>{},3739:()=>{},1821:(e,r,o)=>{"use strict";o.d(r,{Z:()=>t});let t=(0,o(6557).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},165:(e,r,o)=>{"use strict";o.d(r,{Z:()=>t});let t=(0,o(6557).Z)("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]])},8443:(e,r,o)=>{"use strict";o.d(r,{C:()=>i});var t=o(326);o(7577);var a=o(9360),s=o(1223);let n=(0,a.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i({className:e,variant:r,...o}){return t.jsx("div",{className:(0,s.cn)(n({variant:r}),e),...o})}},753:(e,r,o)=>{"use strict";o.d(r,{CH:()=>l,U$:()=>u,hG:()=>c});var t=o(7577),a=o(2777),s=o(9639);let n="properties-images";async function i(e){try{if(!e.type.startsWith("image/"))return{success:!1,error:"El archivo debe ser una imagen"};if(e.size>5242880)return{success:!1,error:"La imagen es demasiado grande (m\xe1ximo 5MB)"};let r=e.name.split(".").pop(),o=`${Date.now()}_${Math.random().toString(36).substring(2)}.${r}`,{data:t,error:s}=await a.O.storage.from(n).upload(o,e);if(s)return{success:!1,error:s.message};let{data:i}=a.O.storage.from(n).getPublicUrl(o);return{success:!0,url:i.publicUrl}}catch(e){return{success:!1,error:"Error al subir la imagen"}}}let l={title:"",description:"",price:"",currency:"USD",operation_type:"",property_type:"",bedrooms:"0",bathrooms:"0",construccion:"",terreno:"",address:"",neighborhood:"",city:"San Miguel de Tucum\xe1n",province:"Tucum\xe1n",country:"Argentina",features:"",images:[],featured:!1,status:"disponible",barrio_cerrado:!1,es_country:!1,paga_expensas:!1};function c(){let[e,r]=(0,t.useState)([]),[o,n]=(0,t.useState)(!0),[l,c]=(0,t.useState)(null),u=async()=>{try{n(!0),c(null);let{data:e,error:o}=await a.O.from("properties").select("*").order("created_at",{ascending:!1});if(o)throw o;r(e||[])}catch(e){console.error("Error al cargar propiedades:",e),c("Error al cargar las propiedades")}finally{n(!1)}},d=async e=>{try{if(c(null),!e.title||!e.price||!e.operation_type||!e.property_type)return c("Por favor completa todos los campos obligatorios"),!1;let r=[],o=e.images.filter(e=>"file"===e.type&&e.file);if(o.length>0){for(let e of(console.log(`üì§ Subiendo ${o.length} im\xe1genes nuevas...`),o))if(e.file){let o=await i(e.file);if(!o.success||!o.url)return console.error("Error subiendo imagen:",o.error),c(`Error al subir imagen: ${o.error}`),!1;r.push(o.url)}}let t=[...e.images.filter(e=>"url"===e.type&&e.url).map(e=>e.url),...r],s={title:e.title,description:e.description,price:parseFloat(e.price),currency:e.currency,operation_type:e.operation_type,property_type:e.property_type,bedrooms:parseInt(e.bedrooms),bathrooms:parseInt(e.bathrooms),construccion:parseFloat(e.construccion)||null,terreno:e.terreno?parseFloat(e.terreno):null,address:e.address,neighborhood:e.neighborhood,city:e.city,province:e.province,country:e.country,features:e.features?e.features.split(",").map(e=>e.trim()):[],images:t,featured:e.featured,status:e.status,barrio_cerrado:e.barrio_cerrado,es_country:e.es_country,paga_expensas:e.paga_expensas},{error:n}=await a.O.from("properties").insert([s]);if(n)throw n;return await u(),!0}catch(e){return console.error("Error al crear propiedad:",e),c("Error al crear la propiedad"),!1}},p=async(e,r)=>{try{if(c(null),!r.title||!r.price||!r.operation_type||!r.property_type)return c("Por favor completa todos los campos obligatorios"),!1;let o=[],t=r.images.filter(e=>"file"===e.type&&e.file);if(t.length>0){for(let e of(console.log(`üì§ Subiendo ${t.length} im\xe1genes nuevas...`),t))if(e.file){let r=await i(e.file);if(!r.success||!r.url)return console.error("Error subiendo imagen:",r.error),c(`Error al subir imagen: ${r.error}`),!1;o.push(r.url)}}let s=[...r.images.filter(e=>"url"===e.type&&e.url).map(e=>e.url),...o],n={title:r.title,description:r.description,price:parseFloat(r.price),currency:r.currency,operation_type:r.operation_type,property_type:r.property_type,bedrooms:parseInt(r.bedrooms),bathrooms:parseInt(r.bathrooms),construccion:parseFloat(r.construccion)||null,terreno:r.terreno?parseFloat(r.terreno):null,address:r.address,neighborhood:r.neighborhood,city:r.city,province:r.province,country:r.country,features:r.features?r.features.split(",").map(e=>e.trim()):[],images:s,featured:r.featured,status:r.status,barrio_cerrado:r.barrio_cerrado,es_country:r.es_country,paga_expensas:r.paga_expensas},{error:l}=await a.O.from("properties").update(n).eq("id",e);if(l)throw l;return await u(),!0}catch(e){return console.error("Error al actualizar propiedad:",e),c("Error al actualizar la propiedad"),!1}},g=async e=>{try{c(null);let r=await (0,s.zu)(e);if(!r.success)throw Error(r.error||"Error al eliminar la propiedad");return await u(),!0}catch(e){return console.error("Error al eliminar propiedad:",e),c(e instanceof Error?e.message:"Error al eliminar la propiedad"),!1}},m={total:e.length,ventas:e.filter(e=>"venta"===e.operation_type).length,alquileres:e.filter(e=>"alquiler"===e.operation_type).length,destacadas:e.filter(e=>e.featured).length,disponibles:e.filter(e=>"disponible"===e.status).length,vendidas:e.filter(e=>"vendido"===e.status).length,alquiladas:e.filter(e=>"alquilado"===e.status).length,reservadas:e.filter(e=>"reservado"===e.status).length};return{properties:e,isLoading:o,error:l,stats:m,loadProperties:u,createProperty:d,updateProperty:p,deleteProperty:g,propertyToFormData:e=>{let r=e.images.map(e=>({id:`url_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"url",url:e,preview:e}));return{title:e.title,description:e.description||"",price:e.price.toString(),currency:e.currency,operation_type:e.operation_type,property_type:e.property_type,bedrooms:e.bedrooms.toString(),bathrooms:e.bathrooms.toString(),construccion:e.construccion?.toString()||"",terreno:e.terreno?.toString()||"",address:e.address||"",neighborhood:e.neighborhood||"",city:e.city,province:e.province,country:e.country,features:e.features.join(", "),images:r,featured:e.featured,status:e.status,barrio_cerrado:e.barrio_cerrado||!1,es_country:e.es_country||!1,paga_expensas:e.paga_expensas||!1}},clearError:()=>c(null)}}function u(e=6){let[r,o]=(0,t.useState)([]),[s,n]=(0,t.useState)(!0),[i,l]=(0,t.useState)(null);return{featuredProperties:r,isLoading:s,error:i,loadFeaturedProperties:async()=>{try{n(!0),l(null);let{data:r,error:t}=await a.O.from("properties").select("*").eq("featured",!0).eq("status","disponible").order("created_at",{ascending:!1}).limit(e);if(t)throw t;o(r||[])}catch(e){console.error("Error al cargar propiedades destacadas:",e),l("Error al cargar las propiedades destacadas")}finally{n(!1)}},clearError:()=>l(null)}}},2777:(e,r,o)=>{"use strict";o.d(r,{O:()=>t});let t=(0,o(5158).createBrowserClient)("https://enaltafiofwcbfrlyguz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVuYWx0YWZpb2Z3Y2Jmcmx5Z3V6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg5MTE3NDAsImV4cCI6MjA2NDQ4Nzc0MH0.CSAL1XSmuRG0jkBfP03e0__R-bweK3YIZi_NkiLp1ko")},9639:(e,r,o)=>{"use strict";o.d(r,{In:()=>d,iQ:()=>c,y9:()=>l,zu:()=>u});var t=o(2777);let a="properties-images";async function s(){try{let{data:e}=t.O.storage.from(a).getPublicUrl("test-file.jpg");if(e?.publicUrl){let r=e.publicUrl.replace("test-file.jpg","");return console.log(`üîç URL base detectada: ${r}`),r}}catch(e){console.warn("No se pudo detectar URL base din\xe1micamente, usando fallback")}return`https://wxlzstrodefylrgzr.supabase.co/storage/v1/object/public/${a}/`}let n=null;function i(e,r){try{if(!e.includes(a))return console.warn(`URL no contiene el bucket ${a}: ${e}`),null;if(r&&e.includes(r)){let o=e.replace(r,"");return console.log(`‚úÖ M\xe9todo 1 - Nombre extra\xeddo: ${o}`),o}let o=`/${a}/`,t=e.indexOf(o);if(-1!==t){let r=e.substring(t+o.length);return console.log(`‚úÖ M\xe9todo 2 - Nombre extra\xeddo: ${r}`),r}let s=`${a}/`,n=e.indexOf(s);if(-1!==n){let r=e.substring(n+s.length);return console.log(`‚úÖ M\xe9todo 3 - Nombre extra\xeddo: ${r}`),r}let i=e.split("/"),l=i[i.length-1];if(l&&l.includes("."))return console.log(`‚ö†Ô∏è M\xe9todo 4 (\xfaltimo recurso) - Nombre extra\xeddo: ${l}`),l;return console.error(`‚ùå No se pudo extraer nombre de archivo de: ${e}`),null}catch(e){return console.error("Error al extraer nombre de archivo:",e),null}}async function l(){try{console.log("\uD83D\uDD0D Iniciando an\xe1lisis de im\xe1genes hu\xe9rfanas..."),n||(n=await s()),console.log(`üåê Usando URL base: ${n}`);let{data:e,error:r}=await t.O.storage.from(a).list();if(r)return{success:!1,error:`Error al obtener archivos del Storage: ${r.message}`};if(!e||0===e.length)return console.log("‚úÖ No hay archivos en el Storage"),{success:!0,data:{totalFilesInStorage:0,totalReferencedImages:0,orphanedFiles:[],referencedFiles:[]}};let o=e.map(e=>e.name);console.log(`üìÅ Archivos encontrados en Storage: ${o.length}`);let{data:l,error:c}=await t.O.from("properties").select("images");if(c)return{success:!1,error:`Error al obtener propiedades: ${c.message}`};let u=new Set,d=0,p=0;console.log("\uD83D\uDD17 Procesando URLs de im\xe1genes en la base de datos..."),l&&l.length>0&&l.forEach((e,r)=>{console.log(`üìã Propiedad ${r+1}: ${e.images?.length||0} im\xe1genes`),e.images&&Array.isArray(e.images)&&e.images.forEach((e,r)=>{d++,console.log(`   üñºÔ∏è  Imagen ${r+1}: ${e}`);let o=i(e,n||void 0);o?(u.add(o),p++,console.log(`      ‚úÖ Archivo referenciado: ${o}`)):console.error(`      ‚ùå No se pudo extraer nombre de archivo de: ${e}`)})}),console.log(`üìä URLs procesadas: ${d}`),console.log(`‚úÖ Extracciones exitosas: ${p}`),console.log(`‚ùå Extracciones fallidas: ${d-p}`),console.log(`üîó Archivos \xfanicos referenciados: ${u.size}`);let g=o.filter(e=>!u.has(e));console.log(`üóëÔ∏è Im\xe1genes hu\xe9rfanas encontradas: ${g.length}`);let m={totalFilesInStorage:o.length,totalReferencedImages:u.size,orphanedFiles:g,referencedFiles:Array.from(u)};return{success:!0,data:m}}catch(e){return console.error("Error en findOrphanedImages:",e),{success:!1,error:"Error interno al analizar im\xe1genes hu\xe9rfanas"}}}async function c(e=!0){try{console.log(`üßπ Iniciando limpieza de im\xe1genes hu\xe9rfanas (modo: ${e?"simulaci\xf3n":"real"})...`);let r=await l();if(!r.success||!r.data)return{success:!1,error:r.error};let o=r.data,s=o.orphanedFiles;if(0===o.totalReferencedImages&&o.totalFilesInStorage>0){let e=`üö® PELIGRO: No se encontraron im\xe1genes referenciadas en la DB, pero hay ${o.totalFilesInStorage} archivos en Storage. Esto sugiere un error en la extracci\xf3n de nombres de archivo. LIMPIEZA CANCELADA POR SEGURIDAD.`;return console.error(e),{success:!1,error:e}}if(o.totalFilesInStorage>0){let r=s.length/o.totalFilesInStorage*100;if(r>90){let t=`‚ö†Ô∏è ADVERTENCIA: Se eliminar\xedan ${s.length} de ${o.totalFilesInStorage} archivos (${r.toFixed(1)}%). Esto es sospechoso - por favor revisa manualmente.`;if(console.warn(t),!e)return{success:!1,error:t}}}if(0===s.length)return console.log("‚úÖ No hay im\xe1genes hu\xe9rfanas para eliminar"),{success:!0,deletedCount:0,errors:[]};if(e)return console.log("\uD83D\uDD0D SIMULACI\xd3N - Archivos que se eliminar\xedan:"),s.forEach(e=>console.log(`  - ${e}`)),{success:!0,deletedCount:s.length,errors:[]};let n=[],i=0;for(let e=0;e<s.length;e+=10){let r=s.slice(e,e+10);console.log(`üóëÔ∏è Eliminando lote ${Math.floor(e/10)+1}/${Math.ceil(s.length/10)}`);let{data:o,error:l}=await t.O.storage.from(a).remove(r);l?(n.push(`Error en lote ${Math.floor(e/10)+1}: ${l.message}`),console.error(`‚ùå Error eliminando lote:`,l)):(i+=r.length,console.log(`‚úÖ Eliminados ${r.length} archivos del lote`)),e+10<s.length&&await new Promise(e=>setTimeout(e,500))}return console.log(`üéâ Limpieza completada. Archivos eliminados: ${i}/${s.length}`),{success:!0,deletedCount:i,errors:n.length>0?n:void 0}}catch(e){return console.error("Error en cleanupOrphanedImages:",e),{success:!1,error:"Error interno al limpiar im\xe1genes hu\xe9rfanas"}}}async function u(e){try{console.log(`üè† Iniciando eliminaci\xf3n segura de propiedad: ${e}`),n||(n=await s());let{data:r,error:o}=await t.O.from("properties").select("images").eq("id",e).single();if(o){if("PGRST116"===o.code)return{success:!1,error:"Propiedad no encontrada"};return{success:!1,error:`Error al obtener propiedad: ${o.message}`}}let l=[];r.images&&Array.isArray(r.images)&&r.images.forEach(e=>{let r=i(e,n||void 0);r&&l.push(r)}),console.log(`üñºÔ∏è Im\xe1genes a eliminar: ${l.length}`);let c=0;if(l.length>0){let{data:e,error:r}=await t.O.storage.from(a).remove(l);if(r)return console.error("‚ùå Error eliminando im\xe1genes del Storage:",r),{success:!1,error:`Error al eliminar im\xe1genes: ${r.message}`};c=l.length,console.log(`‚úÖ Eliminadas ${c} im\xe1genes del Storage`)}let{error:u}=await t.O.from("properties").delete().eq("id",e);if(u)return console.error("‚ùå Error eliminando propiedad de la DB:",u),{success:!1,error:`Error al eliminar propiedad: ${u.message}`};return console.log(`üéâ Propiedad eliminada exitosamente: ${e}`),{success:!0,deletedImages:c}}catch(e){return console.error("Error en deletePropertySafely:",e),{success:!1,error:"Error interno al eliminar propiedad"}}}async function d(){try{let e=await l();if(!e.success)return{success:!1,error:e.error};let r=e.data,o={totalFiles:r.totalFilesInStorage,referencedImages:r.totalReferencedImages,orphanedImages:r.orphanedFiles.length,storageHealth:0===r.orphanedFiles.length?"excelente":r.orphanedFiles.length<5?"bueno":r.orphanedFiles.length<20?"regular":"requiere_atencion",lastCheck:new Date().toISOString()};return{success:!0,stats:o}}catch(e){return console.error("Error en getStorageStats:",e),{success:!1,error:"Error interno al obtener estad\xedsticas"}}}}};